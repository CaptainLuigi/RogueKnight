<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chest</title>
    <link rel="stylesheet" href="styleChest.css" />
    <link rel="stylesheet" href="styleDeckDisplay.css" />
    <script src="weapons.js"></script>
    <script src="baseClasses.js"></script>
    <script src="saveGame.js"></script>
    <script src="player.js"></script>
    <script src="relics.js"></script>
  </head>
  <body>
    <div>
      <img
        id="StartscreenBackground"
        src="Assets/background_forest.png"
        alt="ForestBackground"
      />
    </div>
    <button id="chest-button">
      <img id="Chest" src="Assets/Chest.png" alt="Chest" />
    </button>

    <div id="playerGold">Gold:</div>

    <div class="sprite"></div>

    <div id="relic-container"></div>

    <button id="addToDeck">Add</button>
    <button id="skip">Skip</button>

    <button id="current-deck" class="orange-btn">Your Deck</button>
    <div id="weapon-deck-screen" class="hidden">
      <div id="weapon-deck-container">
        <div id="weapon-list"></div>
        <button id="close-deck-btn" class="orange-btn">Close</button>
      </div>
    </div>

    <script>
      let player = new Player("Knight", 100, 100, [], 3, 3);
      player.loadPlayerFromStorage();

      document.addEventListener("DOMContentLoaded", () => {
        document
          .getElementById("current-deck")
          .addEventListener("click", () => {
            player.showDeck();
          });

        document
          .getElementById("close-deck-btn")
          .addEventListener("click", () => {
            document
              .getElementById("weapon-deck-screen")
              .classList.add("hidden");
          });

        const goldDisplay = document.getElementById("playerGold");
        goldDisplay.textContent = "Gold: " + globalSettings.playerGold;

        document
          .getElementById("chest-button")
          .addEventListener("click", openChest);
        document
          .getElementById("addToDeck")
          .addEventListener("click", addRelicToDeck);
        document.getElementById("skip").addEventListener("click", skipRelic);
      });

      const sprite = document.querySelector(".sprite");
      resetToIdleAnimation();

      /**
       * Function to open the chest and reveal a random relic.
       */
      function openChest() {
        console.log("Chest opened!");

        const relicContainer = document.getElementById("relic-container");

        // Ensure the relic container exists before modifying it
        if (!relicContainer) {
          console.error("Relic container not found!");
          return;
        }

        // Display the buttons
        document.getElementById("addToDeck").style.display = "block";
        document.getElementById("skip").style.display = "block";

        // Select a random relic
        const randomRelicName =
          relicNames[Math.floor(Math.random() * relicNames.length)];
        const randomRelic = relics[randomRelicName];

        // Clear previous relics and display new one
        relicContainer.innerHTML = "";

        const relicImage = document.createElement("img");
        relicImage.src = randomRelic.icon;
        relicImage.alt = randomRelic.name;
        relicImage.classList.add("relic-image");

        relicContainer.appendChild(relicImage);

        // Store selected relic name
        relicContainer.setAttribute("data-selected-relic", randomRelicName);
      }

      /**
       * Function to add the selected relic to the player's inventory and update equippedRelics.
       */
      function addRelicToDeck() {
        const relicContainer = document.getElementById("relic-container");

        if (!relicContainer) {
          console.error("Relic container not found!");
          return;
        }

        const selectedRelicName = relicContainer.getAttribute(
          "data-selected-relic"
        );

        if (selectedRelicName) {
          const selectedRelic = relics[selectedRelicName];

          // Add relic to equipped relics array
          player.equippedRelics.push(selectedRelicName);

          // Apply relic effect
          selectedRelic.equipRelic(player);

          console.log(`Added relic: ${selectedRelicName} to equippedRelics.`);
          alert(`${selectedRelicName} added to inventory!`);
        } else {
          console.warn("No relic selected.");
        }

        player.savePlayerToStorage();

        // Redirect to map.html
        window.location.href = "map.html";
      }

      /**
       * Function to skip selecting a relic and go to map.html.
       */
      function skipRelic() {
        console.log("Relic skipped!");

        // Redirect to map.html
        window.location.href = "map.html";
      }
    </script>
  </body>
</html>
