<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startscreen</title>
    <link rel="stylesheet" href="stylestartscreen.css" />
    <link rel="stylesheet" href="styleDeckDisplay.css" />
    <script src="saveGame.js"></script>
    <script src="baseClasses.js"></script>
    <script src="utility.js"></script>
    <script src="player.js"></script>
    <script src="music.js"></script>
  </head>
  <body>
    <div>
      <img
        id="StartscreenBackground"
        src="Assets/background_forest.png"
        alt="ForestBackground"
      />
    </div>

    <div id="pause-menu-button" title="Menu">â˜°</div>

    <div id="pause-menu" class="hidden">
      <button onclick="deleteProgressAndExit()">Abandon Run</button>
      <div class="volume-info">Music Volume</div>
      <input
        type="range"
        id="music-volume-slider"
        class="volume-slider"
        min="0"
        max="1"
        step="0.01"
        value="0.5"
      />
      <div class="volume-info">SFX Volume</div>
      <input
        type="range"
        id="volume-slider"
        class="volume-slider"
        min="0"
        max="1"
        step="0.01"
        value="0.5"
      />
      <!-- <button id="fullScreenBtn" onclick="enterDocumentFullscreen()">
        Enter Fullscreen
      </button> -->
      <button onclick="closePauseMenu()">Close</button>
    </div>

    <div class="flex-container">
      <h1 id="Title">RogueKnight</h1>
      <button class="start-button" onclick="window.location.href='map.html'">
        Play
      </button>
      <button
        class="start-button"
        onclick="globalSettings.setTutorial(); globalSettings.difficulty = 0; window.location.href='Tutorial.html'"
      >
        Tutorial
      </button>

      <button
        class="start-button"
        onclick="window.location.href='Credits.html'"
      >
        Credits
      </button>
    </div>

    <div class="sprite"></div>

    <div id="version">Version 1.4</div>

    <div id="switchToMobile" class="hidden">
      <button onclick="window.location.href='iframeIndex.html'">Mobile</button>
    </div>

    <div id="patchnotes">
      <button onclick="window.location.href='patchnotes.html'">
        Patchnotes
      </button>
    </div>

    <script>
      window.addEventListener("load", () => {
        let isMobile = "ontouchstart" in window;
        if (isMobile && window.top == window) {
          document.getElementById("switchToMobile").classList.remove("hidden");
        }
      });

      globalSettings.clearTutorial();
      const playerSprite = document.querySelector(".sprite");

      const DESIGN_WIDTH = 1920;

      function updateSpriteScale() {
        const scale = window.innerWidth / DESIGN_WIDTH;
        playerSprite.style.transform = `scale(${scale})`;
      }

      window.addEventListener("resize", updateSpriteScale);
      updateSpriteScale();

      // Define the run animation configuration (same style as player.js)
      const runConfig = {
        image: "Assets/Knight_1/Run.png",
        totalFrames: 7,
        frameWidth: 200, // width of each frame in the sprite sheet
        backgroundSize: "1400px 200px", // full sprite sheet size
        frameDelay: 100,
      };

      let runFrame = 0;
      let runInterval;
      let spritePositionX = 0;
      const spriteSpeed = 2;
      const switchPoint2 = 45;

      function animateRun() {
        if (typeof playerSprite === "undefined") return;

        runFrame = (runFrame + 1) % runConfig.totalFrames;
        const frameX = runFrame * runConfig.frameWidth;
        playerSprite.style.backgroundPositionX = `-${frameX}px`;

        spritePositionX += spriteSpeed;
        playerSprite.style.left = `${spritePositionX}%`;

        if (spritePositionX >= switchPoint2) {
          clearInterval(runInterval);
          resetToIdleAnimation();
        }
      }

      function triggerRunAnimation() {
        clearInterval(runInterval);

        playerSprite.style.backgroundImage = `url(${runConfig.image})`;
        playerSprite.style.backgroundSize = runConfig.backgroundSize;

        runFrame = 0;
        playerSprite.style.backgroundPositionX = `0px`;

        runInterval = setInterval(animateRun, runConfig.frameDelay);
      }

      function resetToIdleAnimation() {
        playerSprite.style.backgroundImage = `url(${idleConfig.image})`;
        playerSprite.style.backgroundSize = idleConfig.backgroundSize;

        let frame = 0;

        function animateSprite() {
          frame = (frame + 1) % idleConfig.totalFrames;
          const frameX = frame * idleConfig.frameWidth;
          playerSprite.style.backgroundPositionX = `-${frameX}px`;
        }

        clearInterval(runInterval);
        idleInterval = setInterval(animateSprite, idleConfig.frameDelay);
      }

      // Start running animation
      triggerRunAnimation();

      // globalSettings.clearTutorial();
      // let frame = 0;
      // const playerSprite = document.querySelector(".sprite");

      // function getResponsiveConfig() {
      //   const screenWidth = window.innerWidth;

      //   if (screenWidth >= 1280) {
      //     return {
      //       image: "Assets/Knight_1/Run.png",
      //       totalFrames: 7,
      //       frameWidth: 200,
      //       backgroundSize: "1400px 200px",
      //     };
      //   } else if (screenWidth >= 1024) {
      //     return {
      //       image: "Assets/Knight_1/Run.png",
      //       totalFrames: 7,
      //       frameWidth: 150,
      //       backgroundSize: "1050px 150px",
      //       frameDelay: 100,
      //     };
      //   } else {
      //     return {
      //       image: "Assets/Knight_1/Run.png",
      //       totalFrames: 7,
      //       frameWidth: 100,
      //       backgroundSize: "700px 100px",
      //       frameDelay: 100,
      //     };
      //   }
      // }

      // let currentConfig = getResponsiveConfig();
      // let spritePositionX = 0;
      // const spriteSpeed = 2;
      // const switchPoint2 = 45;

      // function setSpriteConfig(config) {
      //   playerSprite.style.backgroundImage = `url(${config.image})`;
      //   playerSprite.style.backgroundSize = config.backgroundSize;
      // }

      // function animateSprite() {
      //   const xOffset = -(frame * currentConfig.frameWidth);
      //   playerSprite.style.backgroundPosition = `${xOffset}px 0`;

      //   spritePositionX += spriteSpeed;
      //   playerSprite.style.left = `${spritePositionX}%`;

      //   if (spritePositionX >= switchPoint2) {
      //     resetToIdleAnimation();
      //   } else setTimeout(animateSprite, currentConfig.frameDelay);

      //   frame = (frame + 1) % currentConfig.totalFrames;
      // }

      // setSpriteConfig(currentConfig);
      // animateSprite();
    </script>
  </body>
</html>
